
# MISP-Wazuh Integration Script

## Overview

This Python script facilitates the integration of MISP (Malware Information Sharing Platform) with Wazuh, an open-source security monitoring platform. The script is designed to query MISP for Indicators of Compromise (IoCs) based on alerts generated by Wazuh and send relevant threat intelligence back to Wazuh for further analysis and action.

This repository is a fork of the original project [MISP-Wazuh Integration](https://github.com/karelumair/MISP-Wazuh-Integration), which was developed to enhance the capabilities of Wazuh by leveraging MISP's threat intelligence data.

## Features

- Queries MISP for IoCs based on hashes or other attributes present in Wazuh alerts.
- Sends relevant IoC data back to Wazuh for integration into its alerting and monitoring system.
- Supports Sysmon event processing on Windows agents.
- Customizable and extendable for different use cases.

## Installation

### Prerequisites

- Python 3.x
- Wazuh Manager installed and configured.
- MISP instance with API access.
- Necessary Python packages: `requests`, `json`, and others as required by the script.

### Installation Steps

1. **Clone the Repository:**

   ```
   git clone https://github.com/yourusername/MISP-Wazuh-Integration.git
   cd MISP-Wazuh-Integration
   ```

2. **Install Python Dependencies:**

   Ensure all required Python packages are installed:

   ```
   pip install -r requirements.txt
   ```

3. **Configure Wazuh Manager:**

   - Place the script in the appropriate directory on the Wazuh Manager:
   
     ```
     sudo cp custom-misp.py /var/ossec/integrations/
     ```

   - Ensure the script is executable:

     ```
     sudo chmod +x /var/ossec/integrations/custom-misp.py
     ```

4. **Configure MISP:**

   - Ensure MISP is accessible via API.
   - Generate an API key from MISP under `Administration > List Users > Select User > Auth Key`.
   - Update the MISP API key and URL in the script:

     ```
     misp_base_url = "https://<MISP_IP>/attributes/restSearch/"
     misp_api_auth_key = "<Your_MISP_API_Key>"
     ```

## Usage

### Triggering the Script

The script is designed to be triggered automatically by Wazuh when an alert matches the configured criteria. However, you can also run it manually for testing purposes:

```
sudo /var/ossec/integrations/custom-misp.py /var/ossec/integrations/tests/test_alert.json
```

### Example Test Alert

You can create a test alert JSON file to simulate a Wazuh alert:

```
{
   "rule": {
       "groups": ["windows", "sysmon_event1", "sysmon_event1"]
   },
   "data": {
       "win": {
           "eventdata": {
               "hashes": "1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
           }
       }
   },
   "agent": {
       "id": "001",
       "name": "ASUS-Vivo",
       "ip": "192.168.34.54"
   }
}
```

Save this as `test_alert.json` in the `/var/ossec/integrations/tests/` directory and use it to test the script.

## Contributing

If you find any issues or have suggestions for improvements, feel free to open an issue or submit a pull request.

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.
